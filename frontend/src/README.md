[戻る](../README.md)

# 機能の分類

## View
HTML/CSSの生成返却、アニメーションの設定をする。

## ViewModel
ViewはViewModelを監視し、表示する内容を決定する。
View上での操作はまずViewModelに捕捉され、各種必要な部分に伝達される。
具体的には、Viewに登録するイベントリスナは必ずViewModelに定義されたものであるということ。

## 実行ポイント
プログラムの自動実行を担当する。実際に実行される関数はここにはかかれず、アプリケーションロジックレイヤから呼び出される。
単一の拡張機能だが、複数の実行ポイントがあることに注意せよ。それらは`src/manifest.ts`に記述されている。
ただし、本プロジェクトでは全てのエントリーポイントはentrypointsディレクトリに配置する。
実行ポイントとして配置されたファイルが肥大化しないように注意せよ。

## アプリケーションロジック
ストレージの書き換え、複雑なフローの規定、実行などを担当する。

## インフラストラクチャ（ベース）
バックエンドが規定するエンドポイントをラップする。データの永続化処理をラップする。APIにアクセスするためのインターフェイスと実装を定義する。
データをアプリケーションロジックレイヤが使いやすい形（適切な型）で提供する。
その他アプリケーションを作成するための基本的機能を実装する。
つまり、プログラム外部とのデータのやり取りを円滑に行えるようにすることを担当する。

# プロセスの分類

## background
ブラウザの実行中にバックグラウンドで実行されるプロセス。
ViewやViewModelは実現しない。アプリケーションロジックを実現する。~~signalを受け取って処理を行う。~~

## popup
拡張機能アイコンをクリックするとポップアップとして表示されるプロセス。
View,ViewModel,アプリケーションロジックを実現する。UIがユーザーによって閉じられると実行中の処理は中断されてしまうので、
アニメーション用途以外にPromiseやコルーチンを使ってはならない。

## content
サイト(LMS)の表示内容を改変するプロセス。
View,ViewModel,アプリケーションロジックを実現する。
基本的に、LMSから挿入の目印となる要素を見つけて定義されたUI(html)を挿入することになる。
style要素でCSSを当てることになるだろうか。

## option
View,ViewModel,アプリケーションロジックを実現する。
設定画面としてLMSとは独立に表示される。ストレージを共有した独立なサイトページを作ると考えればよいだろう。

# ディレクトリ構成

## entrypoints
各機能
- popupウィンドウ
- サイト内容改変(content)
- backgroundプロセス
- optionページ
の実行ポイントを配置する。実行といえどもそれらはhtmlだったりtsだったりtsxだったりするが、そのあたりはうまく読み替えて下さい。
[詳細](./entrypoints/README.md)

## base
インフラストラクチャの実装はここに配置される。

## app
アプリケーションロジックの実装はここに配置される。

## data
複数の機能、機能類型をまたいで利用される型(DataTransferObject)と定数を定義する。
なお、ここに定義される型は極力シンプルであるべき。

## UI
UIが存在する機能

- popup
- content
- option

のView,ViewModelはここに定義される。

# コーディングのヒント

## 拡張子の違い
View(UI)を扱うプログラムファイルの拡張子は`.tsx`であり、それ以外のものの拡張子は`.ts`である。
UIとロジックの混在を避ける観点からして、`.tsx`は乱用されるべきではない。

`.spec.ts`,`.spec.tsx`は定義されたプログラムの**ユニットテスト**を行うためのファイルの拡張子である。
本プロジェクトでは**結合テスト**の際には`.test.ts`を用いる。

注: ユニットテストとは定義された関数やクラスに対してmockなどを用いてテストを行うもの。
結合テストとは2つ以上の機能を組み合わせて正常に動作するかを確認するものである。

# 注意

## popupにおける実行
popupの処理はpopupウィンドウが閉じると共に中断されてしまうため、アニメーション要素以外で
Promiseやコルーチンを用いてはならない。必ずBackendに処理を委譲すること。~~このためにbase/signalが用意されている。~~
//React hookで良いのでは？